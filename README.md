# lezer-bsl

Грамматика и парсер 1C (BSL) на основе [Lezer](https://lezer.codemirror.net/). Поддерживает синтаксис языка программирования 1С:Предприятие. Парсер предназначен для использования в веб-приложениях и браузерных редакторах кода.

**О Lezer**: Lezer — это парсер-генератор от команды CodeMirror, предназначенный для создания эффективных парсеров с поддержкой инкрементального парсинга. Это делает его идеальным выбором для интеграции в веб-редакторы кода, где требуется быстрое обновление синтаксического дерева при каждом изменении текста. Парсер генерируется из декларативной грамматики и предоставляет структурированное дерево разбора (AST) для дальнейшей обработки кода.

## Особенности

- ✅ Парсинг BSL кода с поддержкой основных конструкций языка
- ✅ Поддержка русских и английских ключевых слов (регистронезависимо)
- ✅ Инкрементальный парсинг для эффективного обновления дерева при изменениях
- ✅ Визуализация дерева парсинга в веб-интерфейсе
- ✅ Полная поддержка выражений, операторов и структур управления
- ✅ Поддержка комментариев и директив препроцессора

## Установка

```bash
npm install
```

или

```bash
yarn install
```

## Использование

### Базовое использование

```typescript
import { LezerBslParser } from './src/parser/LezerBslParser'

const parser = new LezerBslParser()
const code = `
Процедура Тест()
    Перем а = 1;
    Возврат а + 2;
КонецПроцедуры
`

const tree = parser.parse(code)
// Работа с деревом парсинга
```

### Инкрементальный парсинг

Для эффективного обновления при изменениях в редакторе:

```typescript
const parser = new LezerBslParser()
let tree = parser.parse(initialCode)

// При изменении кода
const changes = [
  {
    rangeOffset: 10,
    rangeLength: 5,
    text: "НовыйТекст"
  }
]

tree = parser.update(newCode, changes)
```

### Веб-интерфейс

Запустите демо-приложение для визуализации дерева парсинга:

```bash
npm run dev
```

Откройте браузер по адресу, указанному в консоли (обычно `http://localhost:5173`).

## Поддерживаемые конструкции

### Объявления

- Процедуры и функции
- Параметры (с модификатором `Знач`/`Val`)
- Переменные (`Перем`/`Var`)
- Экспортные методы (`Экспорт`/`Export`)

### Структуры управления

- Условные операторы: `Если`/`If`, `ИначеЕсли`/`ElsIf`, `Иначе`/`Else`
- Циклы: `Пока`/`While`, `Для`/`For` (с `Каждого`/`Each` и `По`/`To`)
- Обработка исключений: `Попытка`/`Try`, `Исключение`/`Except`
- `Возврат`/`Return`, `ВызватьИсключение`/`Raise`

### Выражения

- Арифметические операции: `+`, `-`, `*`, `/`
- Операторы сравнения: `=`, `<>`, `>`, `<`, `>=`, `<=`
- Логические операции: `И`/`AND`, `ИЛИ`/`OR`, `НЕ`/`NOT`
- Вызовы методов и доступ к свойствам
- Индексация массивов
- Литералы: числа, строки, `Истина`/`True`, `Ложь`/`False`, `Неопределено`/`Undefined`
- Создание объектов: `Новый`/`New`

### Другие возможности

- Однострочные комментарии (`//`)
- Директивы препроцессора (`#`)
- Регистронезависимые ключевые слова

## Разработка

### Генерация парсера

После изменения грамматики в `src/bsl.grammar`:

```bash
npm run gen-lezer-bsl
```

### Запуск тестов

```bash
npm test
```

### Сборка

```bash
npm run build
```

### Предпросмотр сборки

```bash
npm run preview
```

## Структура проекта

```
lezer-bsl/
├── src/
│   ├── bsl.grammar          # Грамматика Lezer для BSL
│   ├── main.ts              # Веб-интерфейс для визуализации
│   └── parser/
│       ├── bslParser.ts     # Сгенерированный парсер (не редактировать)
│       ├── bslParser.terms.ts
│       └── LezerBslParser.ts # Обёртка с инкрементальным парсингом
├── tests/
│   └── parser.test.ts       # Тесты парсера
├── index.html               # HTML для демо-приложения
└── package.json
```

## Технологии

- [Lezer](https://lezer.codemirror.net/) - парсер-генератор
- [TypeScript](https://www.typescriptlang.org/) - язык программирования
- [Vite](https://vitejs.dev/) - сборщик и dev-сервер
- [Vitest](https://vitest.dev/) - тестовый фреймворк

## Лицензия

Apache-2.0

## Репозиторий

https://github.com/alkoleft/lezer-bsl
