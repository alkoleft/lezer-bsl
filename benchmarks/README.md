# Бенчмарки производительности парсера

Этот каталог содержит бенчмарк-тесты для измерения производительности парсера BSL.

## Структура

- `modules/` - тестовые BSL модули разных размеров для тестирования
- `benchmark.bench.ts` - файл с бенчмарками для запуска через `vitest bench` (использует встроенную функциональность vitest)

## Тестовые модули

В каталоге `modules/` находятся следующие модули:

- `small.bsl` - небольшой модуль с одной простой процедурой
- `medium.bsl` - средний модуль с несколькими процедурами и функциями
- `large.bsl` - большой модуль со сложной логикой и множеством операторов
- `very-large.bsl` - очень большой модуль с полной структурой обработки данных

## Запуск бенчмарков

Для запуска бенчмарк-тестов используйте команду:

```bash
npm run test:benchmark
```

Или напрямую через vitest:

```bash
npx vitest bench
```

**Важно:** `vitest bench` использует встроенную функциональность vitest для бенчмарков и автоматически ищет файлы с расширениями `.bench.ts` или `.benchmark.ts`. Результаты выводятся в консоль с подробной статистикой (hz, min, max, mean, percentiles и т.д.).

## Что измеряется

Бенчмарки выполняют следующие замеры для каждого модуля:

1. **Полный парсинг** - время полного парсинга модуля с нуля
2. **Инкрементальная вставка** - время обновления дерева при вставке кода в середину модуля
3. **Инкрементальное удаление** - время обновления дерева при удалении кода из середины модуля

Каждый замер выполняется 50 раз (после 10 итераций разогрева), и выводятся следующие метрики:
- Среднее время (mean)
- Минимальное время (min)
- Максимальное время (max)

## Результаты

После выполнения бенчмарков результаты выводятся в консоль с подробной статистикой для каждого модуля, включая:
- Операций в секунду (hz)
- Минимальное, максимальное и среднее время выполнения
- Процентили (p75, p99, p995, p999)
- Относительную погрешность (rme)
- Сравнение производительности между различными операциями

Результаты можно скопировать из консоли и добавить в описание PR для отслеживания производительности парсера.
