# Описание языка 1C (BSL) для грамматики

## Комментарии
- Однострочные: `//` до конца строки
- Могут начинаться с начала строки или после оператора

## Структура модуля
1. Раздел переменных (операторы `Перем`)
2. Раздел процедур и функций
3. Раздел основной программы (исполняемые операторы)

## Операторы
- Разделяются символом `;`
- Могут переходить через строки
- Могут иметь метки: `~метка:Оператор`

## Идентификаторы
- Буквы, цифры, `_`
- Начинаются с буквы или `_`
- Регистронезависимые

## Зарезервированные слова (русские/английские)
```
Если/If, Тогда/Then, ИначеЕсли/ElsIf, Иначе/Else, КонецЕсли/EndIf
Для/For, Каждого/Each, Из/In, По/To, Пока/While, Цикл/Do, КонецЦикла/EndDo
Процедура/Procedure, Функция/Function, КонецПроцедуры/EndProcedure, КонецФункции/EndFunction
Перем/Var, Возврат/Return, Продолжить/Continue, Прервать/Break
И/And, Или/Or, Не/Not
Попытка/Try, Исключение/Except, ВызватьИсключение/Raise, КонецПопытки/EndTry
Новый/New, Выполнить/Execute, Перейти/Goto, Экспорт/Export, Знач/Val
```

## Специальные символы
```
//      - комментарий
|       - перенос строки в строковых константах
~       - начало метки
:       - конец метки
;       - разделитель операторов
()      - параметры, выражения
[]      - индексация, обращение к свойствам по строке
,       - разделитель параметров
""      - строковые литералы
''      - литералы даты
.       - десятичная точка, обращение к свойствам
```

## Операторы
```
+       - сложение, конкатенация
-       - вычитание
*       - умножение
/       - деление
%       - остаток от деления
>       - больше
>=      - больше или равно
<       - меньше
<=      - меньше или равно
=       - присваивание, равенство
<>      - не равно
```

## Объявления

### Переменные
```
Перем Имя1 [Экспорт] [, Имя2 [Экспорт], ...]
```

### Процедуры
```
[Асинх] Процедура Имя([[Знач] Параметр1 [=Значение], ...]) [Экспорт]
    // тело
КонецПроцедуры
```

### Функции
```
[Асинх] Функция Имя([[Знач] Параметр1 [=Значение], ...]) [Экспорт]
    // тело
    [Возврат Значение;]
КонецФункции
```

## Управляющие конструкции

### Условие
```
Если Условие Тогда
    // операторы
[ИначеЕсли Условие Тогда]
    // операторы
[Иначе]
    // операторы
КонецЕсли
```

### Циклы
```
Для Переменная = Начало По Конец Цикл
    // операторы
КонецЦикла

Для Каждого Элемент Из Коллекция Цикл
    // операторы
КонецЦикла

Пока Условие Цикл
    // операторы
КонецЦикла
```

### Переходы
```
~метка: Оператор;
Перейти ~метка;
```

### Динамическое выполнение
```
Выполнить(Строка);
```

### Обработка исключений
```
Попытка
    // операторы
Исключение
    // обработка
    [ВызватьИсключение;]
КонецПопытки

// Варианты ВызватьИсключение:
ВызватьИсключение Выражение;
ВызватьИсключение(Выражение, Категория, Код, ДополнительнаяИнформация, Причина);
```

## Выражения
- Арифметические: `+`, `-`, `*`, `/`, `%`
- Логические: `И`, `ИЛИ`, `НЕ`
- Сравнения: `=`, `<>`, `>`, `<`, `>=`, `<=`
- Вызовы методов: `Объект.Метод()`
- Индексация: `Массив[Индекс]`
- Обращение по строке: `Объект["Свойство"]`
- Создание объектов: `Новый Тип(<Парам1>, <Парам2>, …)`, `Новый(Тип, Параметры)`
- Условное выражение: `?(Условие, Значение1, Значение2)`

## Литералы
- Числа: `123`, `123.45`
- Строки: `"текст"`
- Даты: `'20240101'`
- Булевы: `Истина/True`, `Ложь/False`
- Неопределено: `Неопределено/Undefined`

## Директивы препроцессора
```
#Если Условие Тогда
    // код
#ИначеЕсли Условие Тогда
    // код
#Иначе
    // код
#КонецЕсли
```

Условия: `Сервер`, `ТонкийКлиент`, `ТолстыйКлиентОбычноеПриложение`, `ТолстыйКлиентУправляемоеПриложение`, `ВебКлиент`, `ВнешнееСоединение`

## Дополнительные операторы

### Обработчики событий
```
ДобавитьОбработчик Объект.Событие, ОбработчикСобытия;
УдалитьОбработчик Объект.Событие, ОбработчикСобытия;
```

### Асинхронность
```
Асинх Процедура Имя()
    Ждать Выражение;
КонецПроцедуры

Асинх Функция Имя()
    Ждать Выражение;
    Возврат Значение;
КонецФункции
```

### Тернарный оператор
```
?(Условие, Значение1, Значение2)
```

## Типы данных

### Примитивные типы
- `Число` - до 38 разрядов, литерал: `123`, `123.45`
- `Строка` - Unicode, литерал: `"текст"`
- `Дата` - с точностью до 0.1мс, литерал: `'ГГГГММДДччммсс'`
  - Обязательно: год (4 цифры), месяц (2 цифры), день (2 цифры)
  - Опционально: час, минуты, секунды (по 2 цифры каждое)
  - Разделители игнорируются: `'2017.03.23 10:45:25'`, `'2017\03\23-10~45~25'`
  - Минимальная дата: `'00010101'`
- `Булево` - `Истина/True`, `Ложь/False`
- `Неопределено/Undefined`
- `Null`

### Многострочные строки
```
"строка1"
"строка2"

или

"строка1
|строка2"
```

## Директивы компиляции
```
&НаКлиенте (&AtClient)
&НаСервере (&AtServer)
&НаСервереБезКонтекста (&AtServerNoContext)
&НаКлиентеНаСервереБезКонтекста (&AtClientAtServerNoContext)
&НаКлиентеНаСервере (&AtClientAtServer)
```

## Аннотации (для расширений)
```
&Перед("МетодИлиСобытие") / &Before("МетодИлиСобытие")
&После("МетодИлиСобытие") / &After("МетодИлиСобытие")
&Вместо("МетодИлиСобытие") / &Around("МетодИлиСобытие")
&ИзменениеИКонтроль("Метод") / &ChangeAndValidate("Метод")
```

## Расширенные директивы препроцессора
```
#Область ИмяОбласти / #Region
#КонецОбласти / #EndRegion
#Вставка / #Insert
#КонецВставки / #EndInsert
#Удаление / #Delete
#КонецУдаления / #EndDelete
```

Дополнительные символы препроцессора:
- `НаКлиенте/AtClient`, `НаСервере/AtServer`
- `МобильныйКлиент/MobileClient`
- `МобильныйАвтономныйСервер/MobileStandaloneServer`
- `МобильноеПриложениеКлиент/MobileAppClient`
- `МобильноеПриложениеСервер/MobileAppServer`

## Приоритеты операций (по возрастанию)
1. `ИЛИ/OR` - логическое сложение
2. `И/AND` - логическое умножение
3. `НЕ/NOT` - логическое отрицание
4. `<`, `<=`, `=`, `>=`, `>`, `<>` - сравнение
5. `+`, `-` - сложение, вычитание
6. `*`, `/`, `%` - умножение, деление, остаток
7. `-`, `+` - унарные операторы
8. `.`, `()` - обращение к свойствам, вызов методов

## Особенности
- Регистронезависимость ключевых слов и идентификаторов
- Параметры по умолчанию передаются по ссылке, `Знач` - по значению
- Метки для `Перейти`: `~метка:`
- Экспорт для доступа извне модуля
- Асинхронные процедуры/функции с `Ждать`
- Короткое вычисление логических выражений
- Многострочные строковые константы
